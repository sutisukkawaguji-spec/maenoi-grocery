// ===== Facebook deep link (เวอร์ชันเสถียร) =====
const FB_PAGE_ID = '801626436372815';
const FB_WEB_URL = `https://www.facebook.com/profile.php?id=${FB_PAGE_ID}`; // ใช้ profile.php เสถียรกว่า handle
const FB_MWEB_URL = `https://m.facebook.com/profile.php?id=${FB_PAGE_ID}`;

function isIOS() {
  const ua = navigator.userAgent || '';
  const iPadDesktop = /Macintosh/.test(ua) && navigator.maxTouchPoints > 1;
  return /iPhone|iPad|iPod/.test(ua) || iPadDesktop;
}
function isAndroid(){ return /Android/i.test(navigator.userAgent || ''); }

function openFacebook() {
  // 1) พยายามเปิดในแอปด้วย facewebmodal (พาเข้าเพจแน่)
  // 2) ลองสคีมา page/profile (บางเครื่องยังใช้ได้)
  // 3) Android ใช้ intent:// เรียกแอปตรง
  // 4) สุดท้ายค่อยไปเว็บ (m.facebook → www.facebook)
  const iosTry = [
    `fb://facewebmodal/f?href=${encodeURIComponent(FB_WEB_URL)}`,
    `fb://page/?id=${FB_PAGE_ID}`,
    `fb://profile/${FB_PAGE_ID}`
  ];
  const androidIntent = `intent://facewebmodal/f?href=${encodeURIComponent(FB_WEB_URL)}#Intent;scheme=fb;package=com.facebook.katana;end`;

  if (isIOS()) {
    // ต้องเป็น navigation ภายในแท็บเดียว (ไม่ใช้ window.open)
    window.location.href = iosTry[0];
    setTimeout(() => {
      window.location.href = iosTry[1];
      setTimeout(() => {
        window.location.href = iosTry[2];
        setTimeout(() => {
          window.location.href = FB_MWEB_URL; // m.facebook ก่อน
          setTimeout(() => { window.location.href = FB_WEB_URL; }, 700);
        }, 700);
      }, 700);
    }, 400);
    return;
  }

  if (isAndroid()) {
    // เรียกแอปผ่าน intent:// ก่อน → ถ้าไม่มีแอปค่อยตกไปเว็บ
    window.location.href = androidIntent;
    setTimeout(() => {
      window.location.href = FB_MWEB_URL;
      setTimeout(() => { window.location.href = FB_WEB_URL; }, 700);
    }, 600);
    return;
  }

  // เดสก์ท็อป ไปเว็บตรง
  window.location.href = FB_WEB_URL;
}
