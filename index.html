<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢ ‡∏ö‡πâ‡∏≤‡∏ô‡∏î‡∏≠‡∏ô‡∏Ç‡∏µ ‚Äî ‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏ä‡∏≥</title>
  <meta name="description" content="‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ ‡πÄ‡∏°‡∏ô‡∏π‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (‡∏´‡∏±‡∏ß‡πÄ‡∏ß‡πá‡∏ö), ‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡∏™‡∏±‡∏ö‡∏†‡∏≤‡∏û‡πÄ‡∏≠‡∏á, ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ß‡∏¥‡πà‡∏á, ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤, ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    body { font-family: 'Noto Sans Thai', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif; }
    .card:hover { transform: translateY(-2px); }
    button, a { touch-action: manipulation; }
    .drawer { position: fixed; top: 0; right: -100%; width: 100%; max-width: 420px; height: 100%; background: #fff; box-shadow: -8px 0 24px rgba(0,0,0,.1); transition: right .28s ease; z-index: 60; display: flex; flex-direction: column; }
    .drawer.open { right: 0; }
    .backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.35); backdrop-filter: blur(1px); z-index: 50; opacity: 0; pointer-events: none; transition: opacity .2s ease; }
    .backdrop.show { opacity: 1; pointer-events: all; }
    .marquee-viewport { overflow: hidden; }
    .marquee-track { display: inline-flex; align-items: center; gap: 16px; width: max-content; animation: marquee-linear 20s linear infinite; will-change: transform; }
    .marquee-viewport:hover .marquee-track { animation-play-state: paused; }
    @keyframes marquee-linear { from { transform: translateX(0); } to { transform: translateX(-50%); } }

    #diag.hidden{ display:none; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <header class="sticky top-0 z-40 bg-white/80 backdrop-blur border-b border-gray-200">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-3">
      <img src="images/logo.png" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏£‡πâ‡∏≤‡∏ô" class="w-10 h-10 rounded-xl object-cover">
      <div>
        <h1 class="text-lg font-semibold leading-tight">‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏ä‡∏≥</h1>
        <p class="text-xs text-gray-500">‡πÄ‡∏°‡∏ô‡∏π‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‚Ä¢ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ß‡∏¥‡πà‡∏á ‚Ä¢ ‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡∏™‡∏±‡∏ö‡πÄ‡∏≠‡∏á ‚Ä¢ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‚Ä¢ ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ ‚Ä¢ LINE</p>
      </div>
      <div class="ms-auto flex items-center gap-2">
        <a id="lineLink" href="#" target="_blank" class="hidden md:inline-flex items-center gap-2 px-3 py-2 rounded-xl border text-sm hover:bg-gray-50">üí¨ ‡πÅ‡∏ä‡∏ï LINE</a>
        <button id="openPromptPayHeader" class="inline-flex items-center gap-2 px-3 py-2 rounded-xl border text-sm hover:bg-gray-50">üí≥ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå</button>
        <button id="openCart" class="relative inline-flex items-center gap-2 px-3 py-2 rounded-xl border text-sm hover:bg-gray-50">
          üß∫ ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ <span id="cartBadge" class="absolute -top-2 -right-2 min-w-[22px] h-[22px] px-1 rounded-full bg-emerald-600 text-white text-xs flex items-center justify-center">0</span>
        </button>
      </div>
    </div>

    <div class="bg-white">
      <div class="max-w-6xl mx-auto px-0 md:px-4 py-2">
        <h3 class="font-semibold mb-2 px-4 md:px-0">üçΩÔ∏è ‡πÄ‡∏°‡∏ô‡∏π‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
        <div class="marquee-viewport rounded-xl border overflow-hidden">
          <div id="bannerTrack" class="marquee-track"></div>
        </div>
      </div>
    </div>
  </header>

  <div id="diag" class="max-w-6xl mx-auto px-4 mt-3 hidden">
    <div class="rounded-xl border border-amber-300 bg-amber-50 text-amber-900 p-3 text-sm">
      <strong class="block mb-1">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong>
      <ul id="diagList" class="list-disc ps-5 space-y-1"></ul>
    </div>
  </div>

  

  <section id="banner-manual" class="relative bg-white">
    <div class="max-w-6xl mx-auto px-4 py-4">
      <h3 class="font-semibold mb-2">üéÅ ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡∏ô</h3>
      <div class="overflow-hidden rounded-xl border relative">
        <div id="manualBanner" class="w-full h-56 md:h-72 flex items-center justify-center bg-gray-100"></div>
        <button id="bannerPrev" class="absolute left-2 top-1/2 -translate-y-1/2 px-3 py-2 rounded-full bg-white/80 border text-sm">‚Äπ</button>
        <button id="bannerNext" class="absolute right-2 top-1/2 -translate-y-1/2 px-3 py-2 rounded-full bg-white/80 border text-sm">‚Ä∫</button>
      </div>
    </div>
  </section>

  <section id="announce" class="bg-white border-y border-gray-200">
    <div class="max-w-6xl mx-auto px-4 py-3">
      <div class="marquee-viewport rounded-xl">
        <div id="announceTrack" class="marquee-track text-sm md:text-base"></div>
      </div>
    </div>
  </section>

  <section id="featured" class="bg-white border-y border-gray-200 hidden">
    <div class="max-w-6xl mx-auto px-4 py-4">
      <div class="flex items-center gap-2 mb-2"><span class="text-lg">‚≠ê</span><h3 class="font-semibold">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3></div>
      <div id="featuredGrid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4"></div>
    </div>
  </section>

  <main class="max-w-6xl mx-auto px-4 py-6">
    <section class="mb-5 grid grid-cols-1 md:grid-cols-12 gap-3">
      <div class="md:col-span-5">
        <label class="text-sm text-gray-600">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
        <input id="searchInput" type="search" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏≤‡∏°‡πà‡∏≤ ‡∏ô‡∏° UHT..." class="mt-1 w-full px-4 py-2.5 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-emerald-500" />
      </div>
      <div class="md:col-span-4">
        <label class="text-sm text-gray-600">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
        <select id="categorySelect" class="mt-1 w-full px-4 py-2.5 rounded-xl border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-emerald-500">
          <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
        </select>
      </div>
      <div class="md:col-span-3">
        <label class="text-sm text-gray-600">‡∏ä‡πà‡∏ß‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤</label>
        <div class="mt-1 flex items-center gap-2">
          <input id="minPrice" type="number" min="0" inputmode="numeric" placeholder="‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î" class="w-full px-4 py-2.5 rounded-xl border border-gray-300 focus:ring-2 focus:ring-emerald-500" />
          <span class="text-gray-400">-</span>
          <input id="maxPrice" type="number" min="0" inputmode="numeric" placeholder="‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î" class="w-full px-4 py-2.5 rounded-xl border border-gray-300 focus:ring-2 focus:ring-emerald-500" />
        </div>
      </div>
    </section>

    <section class="mb-4 text-sm text-gray-600 flex items-center gap-3">
      <span id="resultCount">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
      <span class="hidden md:inline">‚Ä¢</span>
      <button id="clearFilters" class="text-emerald-700 hover:underline">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</button>
    </section>

    <section id="productGrid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4"></section>
  </main>

  <footer class="border-t border-gray-200 py-10 text-center text-sm bg-white">
    <h3 class="text-lg font-semibold mb-2 text-emerald-700">‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢ ‡∏ö‡πâ‡∏≤‡∏ô‡∏î‡∏≠‡∏ô‡∏Ç‡∏µ</h3>
    <p class="text-gray-600">üè† ‡∏ö‡πâ‡∏≤‡∏ô‡∏î‡∏≠‡∏ô‡∏Ç‡∏µ ‡∏ï‡∏≥‡∏ö‡∏•‡∏•‡∏≥‡∏†‡∏π ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏ô‡∏≠‡∏á‡∏ö‡∏±‡∏ß‡∏•‡∏≥‡∏†‡∏π ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏´‡∏ô‡∏≠‡∏á‡∏ö‡∏±‡∏ß‡∏•‡∏≥‡∏†‡∏π 39000</p>
    <p class="text-gray-600 mt-1">üìû ‡πÇ‡∏ó‡∏£: <a href="tel:0880699227" class="text-emerald-700 hover:underline">088-069-9227</a></p>
    <div class="flex items-center justify-center gap-3 mt-3">
      <a href="https://facebook.com/801626436372815" target="_blank" rel="noopener" class="inline-flex items-center gap-1 px-3 py-2 rounded-xl border text-sm hover:bg-gray-50">Facebook</a>
      <a id="lineLinkFooter" href="#" target="_blank" rel="noopener" class="inline-flex items-center gap-1 px-3 py-2 rounded-xl border text-sm hover:bg-gray-50">LINE</a>
      <button id="openPromptPayFooter" type="button" class="inline-flex items-center gap-1 px-3 py-2 rounded-xl border text-sm hover:bg-gray-50">üí≥ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå</button>
    </div>
    <p class="mt-6 text-gray-400 text-xs">¬© <span id="y"></span> ‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢ ‡∏ö‡πâ‡∏≤‡∏ô‡∏î‡∏≠‡∏ô‡∏Ç‡∏µ </p>
  </footer>

  <aside id="cartDrawer" class="drawer" aria-hidden="true">
    <div class="px-4 py-3 border-b flex items-center justify-between">
      <h3 class="font-semibold">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
      <button id="closeCart" class="text-gray-500 hover:text-gray-800">‚úï</button>
    </div>
    <div id="cartList" class="flex-1 overflow-auto divide-y"></div>
    <div class="border-t p-4 space-y-2">
      <div class="flex items-center justify-between text-sm">
        <span class="text-gray-600">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</span>
        <strong id="cartTotal" class="text-lg">‡∏ø0</strong>
      </div>
      <div class="flex gap-2">
        <button id="copyOrder" class="flex-1 px-3 py-2 rounded-xl border text-sm hover:bg-gray-50">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
        <button id="checkout" class="flex-1 px-3 py-2 rounded-xl bg-emerald-600 text-white text-sm hover:opacity-90">‡∏™‡πà‡∏á‡∏ó‡∏≤‡∏á LINE</button>
      </div>
      <button id="clearCart" class="w-full px-3 py-2 rounded-xl border text-sm hover:bg-gray-50">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
    </div>
  </aside>

  <dialog id="qrModal" class="p-0 rounded-2xl shadow-2xl">
    <div class="p-4 bg-white rounded-2xl">
      <h3 class="text-center text-lg font-semibold mb-2">PromptPay</h3>
      <img src="images/promptpay.png" alt="QR PromptPay" class="w-48 h-48 mx-auto border rounded-lg object-contain">
      <p class="text-center text-gray-600 mt-2">‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</p>
      <div class="text-center mt-3"><button type="button" id="closePromptPay" class="text-emerald-700 hover:underline text-sm">‡∏õ‡∏¥‡∏î</button></div>
    </div>
  </dialog>

  <script>
    const STORE_NAME = '‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢ ‡∏ö‡πâ‡∏≤‡∏ô‡∏î‡∏≠‡∏ô‡∏Ç‡∏µ';
    const LINE_ID = '@906dooke';
    const OA_ID_ENC = encodeURIComponent(LINE_ID);
    const lineChatUrl = (text='') => `https://line.me/R/oaMessage/${OA_ID_ENC}/?text=${encodeURIComponent(text)}`;

    const FILE_PRODUCTS = './data/products.txt';
    const FILE_MENU     = './data/menu.txt';
    const FILE_ANN      = './data/announce.txt';

    let PRODUCTS = [];
    let state = { q:'', category:'', min:'', max:'' };
    let cart = JSON.parse(localStorage.getItem('cart') || '{}');
    let __menuTimer = null;

    const $ = sel => document.querySelector(sel);
    const fmtBaht = n => new Intl.NumberFormat('th-TH', { style: 'currency', currency: 'THB', maximumFractionDigits: 0 }).format(n);
    function normalizeId(x){ return String(x ?? '').trim(); }
    function showError(msg){ const box = document.getElementById('diag'); const ul = document.getElementById('diagList'); if(box && ul){ box.classList.remove('hidden'); const li = document.createElement('li'); li.textContent = msg; ul.appendChild(li); } console.warn('[DIAG]', msg); }

    function toCdnGit(input) {
      if (!input) return '';
      const u = String(input).trim();
      let urlObj;
      try { urlObj = new URL(u); }
      catch { const sep = u.includes('?') ? '&' : '?'; return `${u}${sep}_=${Date.now()}`; }
      if (urlObj.hostname === 'github.com') {
        const parts = urlObj.pathname.split('/').filter(Boolean);
        if (parts.length >= 4 && parts[2] === 'blob') {
          const [owner, repo, , branch, ...rest] = parts;
          return `https://cdn.jsdelivr.net/gh/${owner}/${repo}@${branch}/${rest.join('/')}?_=${Date.now()}`;
        }
      }
      if (urlObj.hostname === 'raw.githubusercontent.com') {
        const parts = urlObj.pathname.split('/').filter(Boolean);
        if (parts.length >= 4) {
          const [owner, repo, branch, ...rest] = parts;
          return `https://cdn.jsdelivr.net/gh/${owner}/${repo}@${branch}/${rest.join('/')}?_=${Date.now()}`;
        }
      }
      const sep = u.includes('?') ? '&' : '?';
      return `${u}${sep}_=${Date.now()}`;
    }
    function stripBom(t){ if(!t) return ''; return (t.charCodeAt(0) === 0xFEFF) ? t.slice(1) : t; }
    function parseTable(text){
      const clean = stripBom(text);
      if (typeof Papa !== 'undefined'){
        const first = (clean.split('\n')[0]||'');
        const primary = (first.includes(',')) ? ',' : '\t';
        const { data } = Papa.parse(clean, { delimiter: primary, skipEmptyLines: true, transform: v => (v ?? '').toString().trim() });
        return data;
      }
      return clean.split('\n').map(l => l.trim()).filter(Boolean).map(l => (l.includes(',') ? l.split(',') : l.split('\t')).map(s => s.trim()));
    }

    async function fetchText(url){
      try{
        const res = await fetch(`${url}?_=${Date.now()}`, { cache: 'no-store' });
        if(!res.ok) throw new Error(`HTTP ${res.status} @ ${url}`);
        return await res.text();
      }catch(e){ throw new Error(`‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: ${url} :: ${e.message}`); }
    }

    async function loadProducts(){
      try{
        const text = await fetchText(FILE_PRODUCTS);
        const rows = parseTable(text);
        PRODUCTS = rows.map((r,i)=>{
          const [idRaw, name, priceRaw, unit, category, img, flag] = r;
          const id = idRaw || String(i+1);
          const price = Number((String(priceRaw||'').replace(/[^\d.]/g,''))) || 0;
          const featured = String(flag||'').trim().toUpperCase() === 'A';
          return { id:String(id), name, price, unit, category, img: toCdnGit(img||'images/placeholder.png'), featured, active:true };
        });
        if(!PRODUCTS.length){
          showError('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô data/products.txt ‚Äî ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏Å‡πà‡∏≠‡∏ô');
          PRODUCTS = [
            {id:'101', name:'‡πÇ‡∏Ñ‡πâ‡∏Å‡∏Å‡∏£‡∏∞‡∏õ‡πã‡∏≠‡∏á', price:15, unit:'‡∏Å‡∏£‡∏∞‡∏õ‡πã‡∏≠‡∏á', category:'‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°', img:'https://picsum.photos/seed/coke/800/600', featured:true, active:true},
            {id:'102', name:'‡∏°‡∏≤‡∏°‡πà‡∏≤‡∏´‡∏°‡∏π‡∏™‡∏±‡∏ö', price:7, unit:'‡∏ã‡∏≠‡∏á', category:'‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏´‡πâ‡∏á', img:'https://picsum.photos/seed/mama/800/600', featured:false, active:true}
          ];
        }
      }catch(e){ showError(e.message); PRODUCTS = [{id:'101', name:'‡πÇ‡∏Ñ‡πâ‡∏Å‡∏Å‡∏£‡∏∞‡∏õ‡πã‡∏≠‡∏á', price:15, unit:'‡∏Å‡∏£‡∏∞‡∏õ‡πã‡∏≠‡∏á', category:'‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°', img:'https://picsum.photos/seed/coke/800/600', featured:true, active:true}]; }
    }
    async function loadDailyMenu(){
      try{
        const text = await fetchText(FILE_MENU);
        const rows = parseTable(text);
        window.DAILY_MENU = rows.map(r=>({ title:r[0]||'', img: toCdnGit(r[1]||'') })).filter(m=>m.title && m.img);
        if(!window.DAILY_MENU.length){
          showError('‡πÄ‡∏°‡∏ô‡∏π‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ß‡πà‡∏≤‡∏á/‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å data/menu.txt ‚Äî ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß');
          window.DAILY_MENU = [
            { title:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡πÑ‡∏Å‡πà', img:'https://picsum.photos/seed/gaprao/1200/600' },
            { title:'‡∏ú‡∏±‡∏î‡πÑ‡∏ó‡∏¢‡∏Å‡∏∏‡πâ‡∏á‡∏™‡∏î', img:'https://picsum.photos/seed/padthai/1200/600' }
          ];
        }
      }catch(e){ showError(e.message); window.DAILY_MENU = [ { title:'‡∏Ç‡πâ‡∏≤‡∏ß‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡πÑ‡∏Å‡πà', img:'https://picsum.photos/seed/gaprao/1200/600' } ]; }
    }
    async function loadAnnounces(){
      try{
        const text = await fetchText(FILE_ANN);
        const rows = parseTable(text);
        window.ANNOUNCES = rows.map(r=>({ text:r[0]||'', href:r[1]||'' })).filter(a=>a.text);
        if(!window.ANNOUNCES.length){
          showError('‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ß‡πà‡∏≤‡∏á/‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å data/announce.txt ‚Äî ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß');
          window.ANNOUNCES = [
            { text:'‡πÇ‡∏õ‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô ‡∏•‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏£‡πâ‡∏≤‡∏ô 10%', href:'https://line.me/ti/p/%40906dooke' },
            { text:'‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î 31 ‡∏ò.‡∏Ñ. - 1 ‡∏°.‡∏Ñ.', href:'' }
          ];
        }
      }catch(e){ showError(e.message); window.ANNOUNCES = [ { text:'‡πÇ‡∏õ‡∏£‡∏Ø ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ ‡∏•‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 30%', href:'' } ]; }
    }

    function uniqueCategories(items){ return Array.from(new Set(items.map(i => i.category).filter(Boolean))).sort((a,b)=>String(a).localeCompare(String(b),'th')); }
    function filterItems(items){
      const q = state.q.trim().toLowerCase();
      const c = state.category;
      const min = state.min === '' ? -Infinity : Number(state.min);
      const max = state.max === '' ? Infinity : Number(state.max);
      return items.filter(it => (!q || String(it.name).toLowerCase().includes(q)) && (!c || String(it.category) === c) && (Number(it.price) >= min && Number(it.price) <= max));
    }
    function renderCategories(){
      const sel = document.getElementById('categorySelect'); if(!sel) return;
      sel.innerHTML = '<option value=\"\">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>'; uniqueCategories(PRODUCTS).forEach(cat => { const opt = document.createElement('option'); opt.value = cat; opt.textContent = cat; sel.appendChild(opt); });
    }
    function productCard(it){
      const imgSrc = it.img || 'images/placeholder.png';
      return `<article class="card bg-white border border-gray-200 rounded-2xl overflow-hidden shadow-sm transition-all">
        <div class="aspect-[4/3] bg-gray-100 overflow-hidden"><img src="${imgSrc}" alt="${it.name}" class="w-full h-full object-cover" loading="lazy" width="800" height="600" /></div>
        <div class="p-3"><h3 class="text-sm font-semibold leading-tight">${it.name}</h3>
          <div class="mt-1 flex items-center justify-between"><span class="inline-flex items-center px-2 py-1 rounded-lg bg-emerald-50 text-emerald-700 text-xs font-medium">${fmtBaht(it.price)} / ${it.unit || '-'}</span>
            <span class="text-xs text-gray-500">${it.category || '-'}</span></div>
          <div class="mt-3 grid grid-cols-2 gap-2">
            <button class="btn-add w-full px-3 py-2 rounded-xl bg-emerald-600 text-white text-sm hover:opacity-90" data-id="${it.id}">‡∏´‡∏¢‡∏¥‡∏ö‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
            <button class="btn-chat w-full px-3 py-2 rounded-xl border text-sm hover:bg-gray-50" data-id="${it.id}">‡πÅ‡∏ä‡∏ï‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ</button>
          </div></div></article>`;
    }
    function renderGrid(items){
      const wrap = document.getElementById('productGrid'); if(!wrap) return;
      document.getElementById('resultCount').textContent = items.length;
      wrap.innerHTML = items.length ? items.map(productCard).join('') : '<div class="col-span-full text-center text-gray-500 py-10">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>';
    }
    function renderFeatured(){
      const list = PRODUCTS.filter(p=>p.active!==false && p.featured);
      const sec = document.getElementById('featured'); const grid = document.getElementById('featuredGrid'); if(!sec || !grid) return;
      if(list.length === 0){ sec.classList.add('hidden'); grid.innerHTML=''; return; }
      sec.classList.remove('hidden'); grid.innerHTML = list.map(productCard).join('');
    }
    function renderHeaderMenuBanner(){
      const track = document.getElementById('bannerTrack'); if(!track) return;
      const data = (window.DAILY_MENU || []);
      if(!data.length){ track.innerHTML = '<div class="px-4 py-4 text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏°‡∏ô‡∏π‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‚Äî ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô data/menu.txt</div>'; return; }
      const items = data.map(m => `<figure class="shrink-0 flex flex-col items-center"><img src="${m.img}" alt="${m.title}" class="h-40 md:h-56 object-cover rounded-md border"><figcaption class="text-center text-xs md:text-sm mt-1">${m.title}</figcaption></figure>`).join('');
      track.innerHTML = items + items;
    }
    const BANNERS = ['images/banner1.jpg','images/banner2.jpg','images/banner3.jpg'];
    let bannerIdx = 0;
    const AUTO_SLIDE_MS = 4000; // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÑ‡∏î‡πâ (‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
    let bannerTimer = null;
    function startBannerAuto(){
      stopBannerAuto();
      if(BANNERS.length <= 1) return;
      bannerTimer = setInterval(()=>{
        bannerIdx = (bannerIdx + 1) % BANNERS.length;
        renderManualBanner();
      startBannerAuto();
      const bannerWrap = document.getElementById('manualBanner');
      bannerWrap?.addEventListener('mouseenter', stopBannerAuto);
      bannerWrap?.addEventListener('mouseleave', startBannerAuto);

      }, AUTO_SLIDE_MS);
    }
    function stopBannerAuto(){ if(bannerTimer){ clearInterval(bannerTimer); bannerTimer = null; } }

    function renderManualBanner(){
      const wrap = document.getElementById('manualBanner'); if(!wrap) return;
      if(!BANNERS.length){ wrap.innerHTML = '<div class="text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå</div>'; return; }
      const src = toCdnGit(BANNERS[bannerIdx % BANNERS.length]);
      wrap.innerHTML = `<img src="${src}" class="w-full h-full object-cover" alt="banner">`;
    }
    function renderAnnounce(){
      const track = document.getElementById('announceTrack'); if(!track) return;
      const arr = window.ANNOUNCES || [];
      if(!arr.length){ track.innerHTML = '<span class="px-3 py-2 text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® ‚Äî ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô data/announce.txt</span>'; return; }
      const html = arr.map(a => { const href = a.href ? a.href : '#'; const safeText = a.text.replace(/</g,'&lt;').replace(/>/g,'&gt;'); return `<a href="${href}" ${a.href?'target="_blank" rel="noopener"':''} class="shrink-0 underline decoration-dotted">${safeText}</a>`; }).join('<span class="opacity-50">‚Ä¢</span>');
      track.innerHTML = html + '<span class="opacity-50">‚Ä¢</span>' + html;
    }

    function persistCart(){ localStorage.setItem('cart', JSON.stringify(cart)); }
    function cartCount(){ return Object.values(cart).reduce((a,b)=>a+(Number(b)||0),0); }
    function updateBadge(){ const el = document.getElementById('cartBadge'); if(el) el.textContent = cartCount(); }
    function findProduct(id){ return PRODUCTS.find(p => normalizeId(p.id) === normalizeId(id)); }
    function cartTotal(){ return Object.entries(cart).reduce((sum,[id,qty]) => { const p = findProduct(id); if(!p) return sum; const price = Number(p.price)||0; const q = Number(qty)||0; return sum + (price * q); }, 0); }
    function renderCart(){
      const list = document.getElementById('cartList'); if(!list) return; list.innerHTML = '';
      const entries = Object.entries(cart);
      if(entries.length === 0){ list.innerHTML = '<div class="p-4 text-center text-gray-500">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á</div>'; }
      else { entries.forEach(([id, qty]) => { let p = findProduct(id); if(!p) { p = { name:`‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ID ${id}`, price:0, unit:'', img:'images/placeholder.png' }; }
        const imgSrc = p.img || 'images/placeholder.png';
        const row = document.createElement('div'); row.className = 'p-3 flex items-center gap-3';
        row.innerHTML = `<img src="${imgSrc}" alt="${p.name}" class="w-16 h-12 object-cover rounded-md border">
          <div class="flex-1"><div class="text-sm font-semibold">${p.name}</div><div class="text-xs text-gray-500">${fmtBaht(p.price||0)} / ${p.unit || '-'}</div></div>
          <div class="flex items-center gap-2"><button class="btn-dec px-2 py-1 rounded-lg border" data-id="${id}">-</button><span class="w-8 text-center">${qty}</span><button class="btn-inc px-2 py-1 rounded-lg border" data-id="${id}">+</button></div>
          <div class="w-20 text-right font-medium">${fmtBaht((p.price||0) * qty)}</div>`; list.appendChild(row); }); }
      document.getElementById('cartTotal').textContent = fmtBaht(cartTotal());
    }
    function buildOrderText(){
      const lines = ['‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö: ' + STORE_NAME, '']; Object.entries(cart).forEach(([id, qty]) => { const p = findProduct(id); if(!p) return;
        lines.push(`- ${p.name} x ${qty} (${fmtBaht(p.price)} / ${p.unit || '-'}) = ${fmtBaht(p.price*qty)}`); });
      lines.push(''); lines.push('‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ' + fmtBaht(cartTotal())); lines.push('‡∏Ç‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á/‡∏ô‡∏±‡∏î‡∏£‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö'); return lines.join('\n');
    }

    function refreshUI(){
      renderCategories();
      renderFeatured();
      renderGrid(filterItems(PRODUCTS));
      updateBadge();
      renderHeaderMenuBanner();
      renderAnnounce();
      renderManualBanner();
      startBannerAuto();
      const bannerWrap = document.getElementById('manualBanner');
      bannerWrap?.addEventListener('mouseenter', stopBannerAuto);
      bannerWrap?.addEventListener('mouseleave', startBannerAuto);

    }

    document.addEventListener('DOMContentLoaded', async () => {
      const y = document.getElementById('y'); if (y) y.textContent = new Date().getFullYear();
      const msg = '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö ‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤'; const lineURL = lineChatUrl(msg);
      const setHref = (id, u) => { const el = document.getElementById(id); if (el) el.href = u; };
      setHref('lineLink', lineURL); setHref('lineLinkFooter', lineURL);

      if(location.protocol === 'file:'){
        const warn = document.createElement('div');
        warn.className = 'bg-yellow-100 text-yellow-900 text-sm px-4 py-2 text-center';
        warn.textContent = '‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô http(s):// ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà file:// ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å ./data/*.txt ‡πÑ‡∏î‡πâ';
        document.body.prepend(warn);
        showError('‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ö‡∏ö file:// ‚Äî fetch() ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Å ‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ô‡∏ú‡πà‡∏≤‡∏ô Live Server ‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏Æ‡∏™‡∏ï‡πå http(s)');
      }

      try{ await Promise.all([ loadProducts(), loadDailyMenu(), loadAnnounces() ]); } catch(e){ console.error(e); showError('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + e.message); }

      // Reconcile cart with loaded products
      for (const id of Object.keys(cart)) { if (!findProduct(id)) { delete cart[id]; } }
      localStorage.setItem('cart', JSON.stringify(cart));
      refreshUI();

      document.getElementById('searchInput').addEventListener('input', e => { state.q = e.target.value; renderGrid(filterItems(PRODUCTS)); });
      document.getElementById('categorySelect').addEventListener('change', e => { state.category = e.target.value; renderGrid(filterItems(PRODUCTS)); });
      document.getElementById('minPrice').addEventListener('input', e => { state.min = e.target.value; renderGrid(filterItems(PRODUCTS)); });
      document.getElementById('maxPrice').addEventListener('input', e => { state.max = e.target.value; renderGrid(filterItems(PRODUCTS)); });
      document.getElementById('clearFilters').addEventListener('click', () => { state = { q:'', category:'', min:'', max:'' }; document.getElementById('searchInput').value=''; document.getElementById('categorySelect').value=''; document.getElementById('minPrice').value=''; document.getElementById('maxPrice').value=''; renderGrid(filterItems(PRODUCTS)); });

      const openCart = () => { document.getElementById('cartDrawer').classList.add('open'); document.getElementById('backdrop').classList.add('show'); renderCart(); };
      const closeCart = () => { document.getElementById('cartDrawer').classList.remove('open'); document.getElementById('backdrop').classList.remove('show'); };
      document.getElementById('openCart')?.addEventListener('click', openCart);
      document.getElementById('closeCart')?.addEventListener('click', closeCart);
      document.getElementById('backdrop')?.addEventListener('click', () => { closeCart(); });

      document.addEventListener('click', (e) => {
        const addBtn = e.target.closest('.btn-add'); const chatBtn = e.target.closest('.btn-chat');
        if (addBtn) { const id = normalizeId(addBtn.getAttribute('data-id')); cart[id] = (Number(cart[id]) || 0) + 1; localStorage.setItem('cart', JSON.stringify(cart)); updateBadge(); if(isCartOpen()) { renderCart(); } }
        if (chatBtn) { const id = normalizeId(chatBtn.getAttribute('data-id')); const p = PRODUCTS.find(x => normalizeId(x.id) === id); if(!p) return; const text = `‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠: ${p.name} 1 ${p.unit||''} ‡∏£‡∏≤‡∏Ñ‡∏≤ ${fmtBaht(p.price)}`; window.open(lineChatUrl(text), '_blank'); }
      });

      document.getElementById('cartList').addEventListener('click', (e) => {
        const dec = e.target.closest('.btn-dec'); const inc = e.target.closest('.btn-inc');
        if (dec) { const id = normalizeId(dec.getAttribute('data-id')); cart[id] = Math.max(0, (cart[id]||0) - 1); if(cart[id] === 0) delete cart[id]; localStorage.setItem('cart', JSON.stringify(cart)); renderCart(); updateBadge(); }
        if (inc) { const id = normalizeId(inc.getAttribute('data-id')); cart[id] = (cart[id]||0) + 1; localStorage.setItem('cart', JSON.stringify(cart)); renderCart(); updateBadge(); }
      });

      document.getElementById('clearCart')?.addEventListener('click', () => { cart = {}; localStorage.setItem('cart', JSON.stringify(cart)); renderCart(); updateBadge(); });
      document.getElementById('copyOrder')?.addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText(buildOrderText()); alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß'); } catch{ alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); } });
      document.getElementById('checkout')?.addEventListener('click', ()=> window.open(lineChatUrl(buildOrderText()), '_blank'));

      document.getElementById('bannerPrev')?.addEventListener('click', ()=>{ bannerIdx = (bannerIdx - 1 + BANNERS.length) % BANNERS.length; renderManualBanner();
      startBannerAuto();
      const bannerWrap = document.getElementById('manualBanner');
      bannerWrap?.addEventListener('mouseenter', stopBannerAuto);
      bannerWrap?.addEventListener('mouseleave', startBannerAuto);
 });
      document.getElementById('bannerNext')?.addEventListener('click', ()=>{ bannerIdx = (bannerIdx + 1) % BANNERS.length; renderManualBanner();
      startBannerAuto();
      const bannerWrap = document.getElementById('manualBanner');
      bannerWrap?.addEventListener('mouseenter', stopBannerAuto);
      bannerWrap?.addEventListener('mouseleave', startBannerAuto);
 });
      renderManualBanner();
      startBannerAuto();
      const bannerWrap = document.getElementById('manualBanner');
      bannerWrap?.addEventListener('mouseenter', stopBannerAuto);
      bannerWrap?.addEventListener('mouseleave', startBannerAuto);


      const qr = document.getElementById('qrModal'); const btnPH = document.getElementById('openPromptPayHeader'); const btnPF = document.getElementById('openPromptPayFooter'); const btnClosePP = document.getElementById('closePromptPay');
      btnPH && btnPH.addEventListener('click', ()=> qr?.showModal()); btnPF && btnPF.addEventListener('click', ()=> qr?.showModal()); btnClosePP && btnClosePP.addEventListener('click', ()=> qr?.close()); qr && qr.addEventListener('click', (e)=>{ if(e.target === qr) qr.close(); });
    });
  </script>
  <div id="backdrop" class="backdrop"></div>
</body>
</html>
